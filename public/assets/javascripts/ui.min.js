function showUserControl(){$("#user-control").css("width","30%"),$("#newSongInput").focus(),$("#control-wrapper").removeClass("hidden")}function hideUserControl(){$("#user-control").css("width","1%"),$("#control-wrapper").addClass("hidden")}function getImgFromID(e){return"//img.youtube.com/vi/"+e+"/1.jpg"}function suggestionOn(){$("#newSongInputSuggestion").hasClass("hidden")&&($("#control-title .list-title").text(" Suggestion"),$("#newSongInputSuggestion").removeClass("hidden"),$("#playlist").addClass("hidden"))}function playlistOn(){$("#playlist").hasClass("hidden")&&($("#playlist").removeClass("hidden"),$("#control-title .list-title").text(" Playlist"),$("#newSongInputSuggestion").addClass("hidden"))}function getSelectedItem(e,t,n){var s=$("#"+e+" ."+t),i=$("#"+e+" ."+n);return 0!=i.length?i.first():s.first()}function handleKeyInput(e,t,n,s){{var t=0==t.indexOf("#")?t:"#"+t,s=0==s.indexOf(".")?s:"."+s,n=0==n.indexOf(".")?n:"."+n,i=$(t+" "+n).index($(s));$(t+" "+n),$(t+" "+s)}return 40==e?void(i<$(t+" "+n).length-1&&($(t+" "+n).eq(i+1).addClass(s.substring(1)),$(t+" "+n).eq(i).removeClass(s.substring(1)))):38==e?void(i>0&&($(t+" "+n).eq(i).removeClass(s.substring(1)),$(t+" "+n).eq(i-1).addClass(s.substring(1)))):void 0}function updateSuggestion(e,t,n){var s=encodeURIComponent(e);-1==s.search("kara")&&(s="karaoke "+s);var i="//gdata.youtube.com/feeds/api/videos?q="+s+"&max-results="+t+"&v=2&alt=jsonc",n=0==n.indexOf("#")?n:"#"+n;$.ajax({type:"GET",url:i,dataType:"jsonp",success:function(e){$(n).empty(),e.data.items?($.each(e.data.items,function(e,t){$(n).append("<li data-id='"+t.id+"' data-title='"+escapeQuotes(t.title)+"' data-uploader='"+t.uploader+"' data-view='"+t.viewCount+"' data-duration='"+t.duration+"'  class='suggestion-item'><img class='suggestion-img' src='"+getImgFromID(t.id)+"'><span class='suggestion-info'><div class='suggestion-title'>"+escapeQuotes(t.title)+"</div><span class='suggestion-uploader'>by "+escapeQuotes(t.uploader)+"&nbsp;&nbsp;&nbsp;</span><span class='suggestion-view'>"+t.viewCount+" views</span></span></li>")}),$(".suggestion-item").first().addClass("selected"),$(".suggestion-item").hover(function(){$(this).addClass("selected")},function(){$(this).removeClass("selected")}),$("#startSongInputSuggestion li.suggestion-item").click(function(){openPlayingPage($(this))}),$("#newSongInputSuggestion li.suggestion-item").click(function(){addSong2Playlist($(this))}),setupNiceScroll()):$(n).append("<li>No match found.</li>")}})}function getFrameID(e){var t=document.getElementById(e);if(t){if(/^iframe$/i.test(t.tagName))return e;var n=t.getElementsByTagName("iframe");if(!n.length)return null;for(var s=0;s<n.length&&!/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(n[s].src);s++);if(t=n[s],t.id)return t.id;do e+="-frame";while(document.getElementById(e));return t.id=e,e}return null}function onYouTubePlayerAPIReady(){YT_ready(!0)}function videoStateChanged(e){0===e.data&&($(".playing").removeClass("playing"),current=$("body").scope().playNextSong(),$(".playlist-item").eq(parseInt(current)).addClass("playing"))}function addSong2Playlist(e){playlistOn(),$("body").scope().addSong2Playlist(e),$("#newSongInput").val(""),$("#newSongInputSuggestion").empty(),setupPlaylistItemEffect(),setupNiceScroll()}function setupNiceScroll(){$("#playlist-container").needVerticalScrollBar()&&$("#playlist-container").getNiceScroll().resize()}function setupPlaylistItemEffect(){$(".playlist-item").click(function(){$(".playing").removeClass("playing"),$(this).addClass("playing"),$("body").scope().playSong($(this).data("index"))}),$(".playlist-item").hover(function(){$(this).addClass("selected"),$(this).find(".remove-song-btn").show(100)},function(){$(this).removeClass("selected"),$(this).find(".remove-song-btn").hide(100)})}function openPlayingPage(e){$("html").css("background-image","none"),$("#search-form").remove(),$("#player-frame").removeClass("transparent"),$("#user-control").removeClass("hidden"),$("body").addClass("stripesDarkBackground"),$("#welcome-text").text("KaraTube 0.1.5"),$("#song-input").removeClass("hidden"),$(".info").removeClass("hidden"),$("#playlist-container").niceScroll(),$("#newSongInput").focus(),$("#add-song-btn").click(function(){selectedSong=getSelectedItem("newSongInputSuggestion","suggestion-item","selected"),addSong2Playlist(selectedSong)}),$("body").scope().addSong2Playlist(e),$("#playlist .playlist-item").first().addClass("playing"),setupPlaylistItemEffect()}function escapeQuotes(e){return(e+"").replace('"',"&#34;").replace("'","&#39;")}function callPlayer(e,t,n){window.jQuery&&e instanceof jQuery&&(e=e.get(0).id);var s=document.getElementById(e);s&&"IFRAME"!=s.tagName.toUpperCase()&&(s=s.getElementsByTagName("iframe")[0]),s&&s.contentWindow.postMessage(JSON.stringify({event:"command",func:t,args:n||[],id:e}),"*")}window.screen.availWidth<1200&&($("#welcome-text").text("This app does NOT support your device. Please use either a desktop or a laptop."),$("#welcome-text").css("color","#f2666d")),$("input.deletable").wrap('<span class="deleteicon" />').after($("<span/>").click(function(){$(this).prev("input").val("").focus(),playlistOn()}));var height=.85*$("html").height();$("#startSongInput").focus(),$("#player-frame").css("height",height),$("#user-control").css("height",height),$("#playlist-container").css("height",height-30),function(){var e=document.createElement("script");e.src=("https:"==location.protocol?"https":"http")+"://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),$.fn.needVerticalScrollBar=function(){var e=$(this)[0],t=!1;return e.clientHeight<e.scrollHeight&&(t=!0),t},$("#startSongInput").keyup(function(e){{var t=($(this).attr("id"),e.keyCode?e.keyCode:e.which);$("#startSongInputSuggestion .suggestion-item"),$("#startSongInputSuggestion .selected")}if(-1!=[38,40].indexOf(t))return void handleKeyInput(t,"startSongInputSuggestion","suggestion-item","selected");if(13==t){if(""==$(this).val())return;return selectedSong=getSelectedItem("startSongInputSuggestion","suggestion-item","selected"),void openPlayingPage(selectedSong)}var n=$(this).val();updateSuggestion(n,10,"startSongInputSuggestion")}),$("#newSongInput").keyup(function(e){var t=($(this).attr("id"),e.keyCode?e.keyCode:e.which);if(-1!=[38,40].indexOf(t))return void handleKeyInput(t,"newSongInputSuggestion","suggestion-item","selected");if(13==t){if(""==$(this).val())return;return selectedSong=getSelectedItem("newSongInputSuggestion","suggestion-item","selected"),void addSong2Playlist(selectedSong)}27==t&&($("#newSongInput").val(""),hideUserControl());var n=$(this).val();n.length>=1?(showUserControl(),suggestionOn(),updateSuggestion(n,10,"newSongInputSuggestion")):playlistOn()});var YT_ready=function(){var e=[],t=!1;return function(n,s){if(n===!0)for(t=!0;e.length;)e.shift()();else"function"==typeof n&&(t?n():e[s?"unshift":"push"](n))}}();YT_ready(function(){var e=getFrameID("player-frame");if(e){var t=new YT.Player(e,{id:"qpgTC9MDx1o",events:{onStateChange:videoStateChanged}});$("body").scope().init(t)}}),function(e,t,n,s,i,o,a){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(n),a=t.getElementsByTagName(n)[0],o.async=1,o.src=s,a.parentNode.insertBefore(o,a)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-58841076-2","auto"),ga("send","pageview");